{"version":3,"sources":["assets\\src\\Network\\API.js"],"names":["cc","Class","Component","properties","betScene","type","Node","errorLayer","errorLabel","Label","backHome","onLoad","start","startGuestMode","active","global","isDemo","getComponent","updateCreditLabel","getSettings","window","endPointConfig","networkConfig","ecryptContoller","decrypt","networkConfigJson","JSON","parse","geoIP_url","geoip_url","api_url","host_id","getParameterByName","access_token","xhr","XMLHttpRequest","self","string","onreadystatechange","readyState","status","response","responseText","parsed","settings","data","constant","setSocketURL","socket_url","getSocket","connectSocket","scheduleOnce","body","json","stringify","apiURL","undefined","isProduction","url","open","setRequestHeader","send","error","message","DemoSettings","isPlayerBalanceUpdated","name","location","href","replace","regex","RegExp","results","exec","decodeURIComponent"],"mappings":"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","sourceRoot":"/","sourcesContent":["import * as global from \"GlobalData\";\r\nimport * as constant from \"Constant\";\r\nimport * as ecrypt from \"Encrypt\";\r\nimport * as ecryptContoller from 'ecrypt';\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n\t\t// ...\r\n\t\t\r\n\t\tbetScene:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node,\r\n\t\t},\r\n\r\n\t\terrorLayer:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node,\r\n\t\t},\r\n\t\t\r\n\t\terrorLabel:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Label,\r\n\t\t},\r\n\r\n\t\tbackHome:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node,\t\r\n\t\t},\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n    },\r\n\r\n    start(){\r\n        // this.connectAPI();\r\n    },\r\n\tstartGuestMode() {\r\n\t\tthis.errorLayer.active=false;\r\n\t\tglobal.isDemo = true;\r\n\t\tthis.betScene.getComponent(\"StartScene\").updateCreditLabel();\r\n\t},\r\n    getSettings(){\r\n\t\tif(window.endPointConfig != null){\r\n            var networkConfig = ecryptContoller.decrypt(window.endPointConfig);\r\n            if(networkConfig != null){\r\n                var networkConfigJson = JSON.parse(networkConfig);\r\n\r\n                //cc.log(networkConfigJson.geoip_url);\r\n                //cc.log(networkConfigJson.api_url);\r\n\r\n                global.geoIP_url = networkConfigJson.geoip_url;\r\n                global.api_url = networkConfigJson.api_url;\r\n\r\n                // cc.log(global.SetGeoip_Url(networkConfigJson.geoip_url));\r\n                // cc.log(global.SetApi_Url(networkConfigJson.api_url));\r\n            }\r\n        }\r\n\r\n\t\tglobal.host_id = this.getParameterByName('host_id');\r\n\t\tglobal.access_token = this.getParameterByName('access_token');\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\tvar self = this;\r\n\r\n\t\tif(global.host_id==null && global.access_token==null){\r\n\t\t\tif(!global.isDemo){\r\n\t\t\t\tself.errorLayer.active = true;\r\n\t\t\t\tself.errorLabel.string=\" You Are Playing For Fun.\";\r\n\t\t\t\txhr.onreadystatechange = function(){\r\n\t\t\t\t\tif(xhr.readyState == 4 &&(xhr.status >= 200 && xhr.status < 400)) {\r\n\t\t\t\t\t\tvar response = xhr.responseText;\r\n\t\t\t\t\t\tvar parsed = JSON.parse(response);\r\n\t\t\r\n\t\t\t\t\t\tglobal.settings = parsed.data;\r\n\t\t\t\t\t\tconstant.setSocketURL(global.settings.socket_url);\r\n\t\t\t\t\t\tif(!global.getSocket()){\r\n\t\t\t\t\t\t\tself.getComponent(\"Socket\").connectSocket();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tself.scheduleOnce(function(){\r\n\t\t\t\t\tself.betScene.getComponent(\"StartScene\").updateCreditLabel();\r\n\t\t\t\t\t\r\n\t\t\t\t},0.2);\r\n\t\t\t}\r\n\t\t\r\n\r\n\t\t\tvar body = {\r\n\t\t\t\t\"device_type\": \"Desktop\",\r\n\t\t\t\t\"game_code\": 23,\r\n\t\t\t\t\"country_code\": \"MY\"\r\n\t\t\t}\r\n\t\r\n\t\t\t\r\n\t\t\tvar json = JSON.stringify(body);\r\n\t\t\tvar apiURL= global.api_url;\r\n\t\t\tif (global.api_url == undefined) {\r\n\t\t\t\tapiURL = \"https://bo-stage.slot28.com\";\r\n\t\t\t\tif (global.isProduction) {\r\n\t\t\t\t\tapiURL = \"https://bo.slot28.com\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet url = apiURL+\"/api/user/get-settings-demo\";\r\n\t\t\r\n\t\t\t// let url = \"https://bo-stage-apl.velachip.com/api/user/get-settings?host_id=0e83088027d4c42c8e9934388480c996&access_token=demo01&game_code=21\";\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n\t\t\txhr.setRequestHeader(\"Accept-Language\", \"en-US\");\r\n\t\t\txhr.send(json);\r\n\t\t}\r\n\r\n\t\telse{\r\n\t\t\txhr.onreadystatechange = function(){\r\n\t\t\t\tif(xhr.readyState == 4 &&(xhr.status >= 200 && xhr.status < 400)) {\r\n\t\t\t\t\tvar response = xhr.responseText;\r\n\t\t\t\t\tvar parsed = JSON.parse(response);\r\n\t\r\n\t\t\t\t\tglobal.settings = parsed.data;\r\n\t\t\t\t\tconstant.setSocketURL(global.settings.socket_url);\r\n\t\t\t\t\tif(!global.getSocket()){\r\n\t\t\t\t\t\tself.getComponent(\"Socket\").connectSocket();\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t//global.balance = global.settings.balance;\r\n\t\r\n\t\t\t\t\tif(global.settings==undefined){\r\n\t\t\t\t\t\tself.errorLayer.active = true;\r\n\t\t\t\t\t\tself.errorLabel.string = parsed.error.message;\r\n\t\t\t\t\t\tglobal.settings=global.DemoSettings;\r\n\t\t\t\t\t\tself.backHome.active=true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tglobal.isPlayerBalanceUpdated = true;\r\n\t\t\t\t\t\tself.betScene.getComponent(\"StartScene\").updateCreditLabel();\r\n\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// console.log(global.getSettings());\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\r\n\t\t\tvar body = {\r\n\t\t\t\t\"host_id\": this.getParameterByName('host_id'), \r\n\t\t\t\t\"access_token\": this.getParameterByName('access_token'),\r\n\t\t\t\t\"device_type\": \"Desktop\",\r\n\t\t\t\t\"game_code\": 23,\r\n\t\t\t\t\"country_code\": \"MY\"\r\n\t\t\t}\r\n\t\r\n\t\t\tvar json = JSON.stringify(body);\r\n\t\t\tvar apiURL = global.api_url;\r\n\t\t\tif (global.api_url == undefined) {\r\n\t\t\t\tapiURL = \"https://bo-stage.slot28.com\";\r\n\t\t\t\tif (global.isProduction) {\r\n\t\t\t\t\tapiURL = \"https://bo.slot28.com\";\r\n\t\t\t\t}\r\n\t\t\t\tglobal.api_url=apiURL;\r\n\t\t\t}\r\n\r\n\t\t\tlet url = apiURL + \"/api/user/get-settings?host_id=\"+global.host_id+\"&access_token=\"+global.access_token+\"&game_code=23\";\r\n\t\t\t// let url = \"https://bo.slot28.com/api/user/get-settings?host_id=\"+global.host_id+\"&access_token=\"+global.access_token+\"&game_code=23\";\r\n\t\r\n\t\t\t// let url = \"https://bo-stage-apl.velachip.com/api/user/get-settings?host_id=0e83088027d4c42c8e9934388480c996&access_token=demo06&game_code=23\";\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n\t\t\txhr.setRequestHeader(\"Accept-Language\", \"en-US\");\r\n\t\t\txhr.send(json);\r\n\t\t}\r\n\t\t\r\n\t},\r\n\tgetParameterByName(name, url) {\r\n\t\tif (!url) url = window.location.href;\r\n\t\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\r\n\t\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\r\n\t\t\tresults = regex.exec(url);\r\n\t\tif (!results) return null;\r\n\t\tif (!results[2]) return '';\r\n\r\n\t\t\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\r\n\t},\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}