{"version":3,"sources":["assets\\src\\components\\game\\stage\\Block.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class Block extends cc.Component {\r\n\r\n    @property(cc.Float)\r\n    public maxScale: number = 0;\r\n    @property(cc.Float)\r\n    public minScale: number = 0;\r\n    @property(cc.Float)\r\n    public minDistance: number = 0;\r\n    @property(cc.Float)\r\n    public maxDistance: number = 0;\r\n    @property(cc.Float)\r\n    public anchorOffset: number = 0;\r\n    @property(cc.Integer)\r\n    public score: number = 1;\r\n\r\n    @property([cc.Node])\r\n    private rightAnchorList: Array<cc.Node> = [];\r\n    @property([cc.Node])\r\n    private leftAnchorList: Array<cc.Node> = [];\r\n    @property(cc.Node)\r\n    private centerAnchor: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    private p1:cc.Node = null;\r\n    @property(cc.Node)\r\n    private p2:cc.Node = null;\r\n    @property(cc.Vec2)\r\n    private localPlayerPos:cc.Vec2 = null;\r\n    public trueScore: number = 0;\r\n\r\n    public getCenterPosition():cc.Vec2 {\r\n        return this.centerAnchor.parent.convertToWorldSpaceAR(this.centerAnchor.position);\r\n    }\r\n\r\n    public getAnchorLocation(worldPos:cc.Vec2,direction:number ,platformState):cc.Vec2 {\r\n        let localPos = this.node.convertToNodeSpaceAR(worldPos);\r\n        let anchorList = direction>0?this.rightAnchorList:this.leftAnchorList\r\n        let nearAnchor = anchorList[0];\r\n        let farAnchor = anchorList[0];\r\n        for(let i = 1;i < anchorList.length;i++) {\r\n\r\n            if( anchorList[i].position.sub(localPos).mag()< nearAnchor.position.sub(localPos).mag()\r\n            ){\r\n                nearAnchor = anchorList[i];\r\n            }\r\n            else{\r\n                farAnchor = anchorList[i];\r\n            }\r\n        }\r\n        if(nearAnchor.position.sub(localPos).mag() <=this.anchorOffset) {\r\n            if(platformState==1){\r\n                this.localPlayerPos = nearAnchor.position;\r\n            }\r\n            else{\r\n                this.localPlayerPos = farAnchor.position;\r\n            }\r\n            this.stopAllAction(platformState);\r\n            this.trueScore = this.getScore(platformState);\r\n            return nearAnchor.parent.convertToWorldSpaceAR(nearAnchor.position);\r\n        }else{\r\n            return null;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public getLeftTan():number { \r\n        return this.p1.y/(-this.p1.x);\r\n    }\r\n\r\n    public getRightTan():number {\r\n        cc.log(this.p2.y/this.p2.x);        \r\n        return this.p2.y/this.p2.x;\r\n    }\r\n\r\n    public playScoreAnim() {\r\n        cc.find(\"score\",this.node).parent = cc.find(\"Canvas/stage/ScoreLayer\");\r\n        cc.find(\"score\",this.node).getComponent(cc.Label).string = \"+\"+Math.round(this.trueScore*10)/10;\r\n        cc.find(\"score\",this.node).getComponent(cc.Animation).play();\r\n    }\r\n\r\n    public getScore(platformState){\r\n        return cc.find(\"perfectScore\",this.node).getComponent(\"ScoreMoving\").getScore(platformState);\r\n    }\r\n    public stopAllAction(platformState){\r\n        cc.find(\"perfectScore\",this.node).getComponent(\"ScoreMoving\").stopAll(this.localPlayerPos,platformState);\r\n    }\r\n\r\n    public closePerfectScore(){\r\n        cc.find(\"perfectScore\",this.node).active = false;\r\n    }\r\n    // public shrink() {\r\n    //     // cc.find(\"sprite\",this.node).runAction(cc.scaleTo(2,1,0.5));\r\n    //     this.node.runAction(cc.scaleTo(2,1,0.5));\r\n    // }\r\n\r\n    // public stopShrink() {\r\n    //     // cc.find(\"sprite\",this.node).stopAllActions();\r\n    //     this.node.stopAllActions();\r\n    // }\r\n\r\n    // public enlarge() {\r\n    //     cc.find(\"sprite\",this.node).runAction(cc.scaleTo(1,1,1));\r\n    //     this.node.runAction(cc.scaleTo(1,1,1));\r\n    // }\r\n\r\n}\r\n"]}