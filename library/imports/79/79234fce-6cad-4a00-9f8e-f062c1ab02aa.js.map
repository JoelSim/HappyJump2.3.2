{"version":3,"sources":["assets\\src\\Network\\Socket.js"],"names":["cc","Class","Component","properties","onLoad","decode","data","atob","encode","btoa","socketReceiveAction","global","isEncrypt","JSON","parse","isParsable","input","e","parseDataFormat","connectSocket","log","self","firstConnect","device_type","sys","isMobile","isNative","window","io","SocketIO","tempSocket","connect","constant","getSocketURL","setSocket","getSocket","connected","on","emit_obj","emit","listenEvent","settings","balance","after_balance","finishGeneratingBalance","console","ticket_id","consoScore","consoleScore","perfectScore","platform","finishGetData","errorMessage","error","playerBalance","resp","ecrypt","decrypt","isKicked","kickMessage","message","removeEventListener"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;;;;;AAEAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE,CACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVQ,GAHP;AAgBL;AACA;AACAC,EAAAA,MAAM,EAAE,kBAAY,CAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GA9BI;AAgCL;AACAC,EAAAA,MAjCK,kBAiCEC,IAjCF,EAiCO;AACR;AACA,WAAOC,IAAI,CAACD,IAAD,CAAX;AACH,GApCI;AAsCLE,EAAAA,MAtCK,kBAsCEF,IAtCF,EAsCO;AACR;AACA,WAAOG,IAAI,CAACH,IAAD,CAAX;AACH,GAzCI;AA2CLI,EAAAA,mBA3CK,+BA2CeJ,IA3Cf,EA2CoB;AACrB,QAAGK,MAAM,CAACC,SAAV,EAAoB;AAChB,aAAOC,IAAI,CAACC,KAAL,CAAW,KAAKT,MAAL,CAAYC,IAAZ,CAAX,CAAP;AACH,KAFD,MAGI;AACA,aAAOA,IAAP;AACH;AACJ,GAlDI;AAoDLS,EAAAA,UAAU,EAAG,oBAAUC,KAAV,EAAiB;AAC1B,QAAI;AACAH,MAAAA,IAAI,CAACC,KAAL,CAAWE,KAAX;AACH,KAFD,CAEE,OAAOC,CAAP,EAAU;AACR,aAAO,KAAP;AACH;;AACD,WAAO,IAAP;AACH,GA3DI;AA6DLC,EAAAA,eAAe,EAAE,yBAASZ,IAAT,EAAc;AAC3B,QAAI,KAAKS,UAAL,CAAgBT,IAAhB,KAAyB,IAA7B,EAAkC;AAC9B,aAAOO,IAAI,CAACC,KAAL,CAAWR,IAAX,CAAP;AACH,KAFD,MAEK;AACD,aAAOA,IAAP;AACH;AACJ,GAnEI;AAoEL;AAEAa,EAAAA,aAAa,EAAE,uBAASb,IAAT,EAAc;AACzBN,IAAAA,EAAE,CAACoB,GAAH,CAAO,8CAAP;AACA,QAAIC,IAAI,GAAG,IAAX;AACA,SAAKC,YAAL,GAAoB,IAApB;AACA,QAAIC,WAAW,GAAG,SAAlB;;AACA,QAAGvB,EAAE,CAACwB,GAAH,CAAOC,QAAV,EAAmB;AACfF,MAAAA,WAAW,GAAG,QAAd;AACH;;AAED,QAAIvB,EAAE,CAACwB,GAAH,CAAOE,QAAX,EAAqB;AACjBC,MAAAA,MAAM,CAACC,EAAP,GAAYC,QAAZ,CADiB,CAEjB;;AACA7B,MAAAA,EAAE,CAACoB,GAAH,CAAO,gCAAP,EAHiB,CAIjB;;AACA,UAAGd,IAAI,IAAI,KAAX,EAAiB;AACb,YAAIwB,UAAU,GAAGF,EAAE,CAACG,OAAH,CAAWC,QAAQ,CAACC,YAAT,EAAX,CAAjB;AACAtB,QAAAA,MAAM,CAACuB,SAAP,CAAiBJ,UAAjB;AACA9B,QAAAA,EAAE,CAACoB,GAAH,CAAOY,QAAQ,CAACC,YAAT,EAAP;AACH,OAJD,MAKI;AACA,YAAIH,UAAU,GAAGF,EAAE,CAACG,OAAH,CAAWC,QAAQ,CAACC,YAAT,EAAX,CAAjB;AACAtB,QAAAA,MAAM,CAACuB,SAAP,CAAiBJ,UAAjB;AACA9B,QAAAA,EAAE,CAACoB,GAAH,CAAOY,QAAQ,CAACC,YAAT,EAAP;AACH;AACJ,KAfD,MAeM;AACFjC,MAAAA,EAAE,CAACoB,GAAH,CAAO,oCAAP,EADE,CAEN;AACI;;AACA,UAAGd,IAAI,IAAI,KAAX,EAAiB;AACbN,QAAAA,EAAE,CAACoB,GAAH,CAAO,+BAA6BY,QAAQ,CAACC,YAAT,EAApC;AACA,YAAIH,UAAU,GAAGF,EAAE,CAACI,QAAQ,CAACC,YAAT,EAAD,CAAnB;AACAtB,QAAAA,MAAM,CAACuB,SAAP,CAAiBJ,UAAjB;AACH,OAJD,MAKI;AACA9B,QAAAA,EAAE,CAACoB,GAAH,CAAO,+BAA6BY,QAAQ,CAACC,YAAT,EAApC;AACA,YAAIH,UAAU,GAAGF,EAAE,CAACI,QAAQ,CAACC,YAAT,EAAD,CAAnB;AACAtB,QAAAA,MAAM,CAACuB,SAAP,CAAiBJ,UAAjB;AACH;AACJ;;AAED9B,IAAAA,EAAE,CAACoB,GAAH,CAAO,yBAAP;AACApB,IAAAA,EAAE,CAACoB,GAAH,CAAO,SAAP,EAAkBT,MAAM,CAACwB,SAAP,GAAmBC,SAArC,EAzCyB,CA0CzB;;AACAzB,IAAAA,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,SAAtB,EAAiC,YAAW;AACxCrC,MAAAA,EAAE,CAACoB,GAAH,CAAO,kBAAP;AACApB,MAAAA,EAAE,CAACoB,GAAH,CAAO,SAAP,EAAkBT,MAAM,CAACwB,SAAP,GAAmBC,SAArC;AACA,UAAIE,QAAQ,GAAG,EAAf,CAHwC,CAOxC;;AACA3B,MAAAA,MAAM,CAACwB,SAAP,GAAmBI,IAAnB,CAAwB,WAAxB,EAAoCD,QAApC;AAEH,KAVD;AAWAjB,IAAAA,IAAI,CAACmB,WAAL,GAtDyB,CAuDzB;AACA;AAEA;AACH,GAjII;AAmILA,EAAAA,WAAW,EAAE,uBAAU;AACnB,QAAInB,IAAI,GAAG,IAAX;AACAV,IAAAA,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,SAAtB,EAAiC,UAAS/B,IAAT,EAAc;AAC3CA,MAAAA,IAAI,GAAGe,IAAI,CAACX,mBAAL,CAAyBJ,IAAzB,CAAP;AAEAK,MAAAA,MAAM,CAAC8B,QAAP,CAAgBC,OAAhB,GAA0BpC,IAAI,CAACqC,aAA/B;AACAhC,MAAAA,MAAM,CAACiC,uBAAP,GAAiC,IAAjC;AACH,KALD;AAOAjC,IAAAA,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,cAAtB,EAAsC,YAAU;AAC5CQ,MAAAA,OAAO,CAACzB,GAAR,CAAY,cAAZ;AACH,KAFD;AAIAT,IAAAA,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,WAAtB,EAAmC,YAAU;AACzCQ,MAAAA,OAAO,CAACzB,GAAR,CAAY,mBAAZ;AACH,KAFD;AAIAT,IAAAA,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,WAAtB,EAAmC,UAAS/B,IAAT,EAAc;AAC7CA,MAAAA,IAAI,GAAGe,IAAI,CAACX,mBAAL,CAAyBJ,IAAzB,CAAP;AACAK,MAAAA,MAAM,CAACmC,SAAP,GAAmBxC,IAAI,CAACwC,SAAxB;AACAnC,MAAAA,MAAM,CAAC8B,QAAP,CAAgBC,OAAhB,GAA0BpC,IAAI,CAACoC,OAA/B;AACA/B,MAAAA,MAAM,CAACoC,UAAP,GAAoBzC,IAAI,CAAC0C,YAAzB;AACArC,MAAAA,MAAM,CAACsC,YAAP,GAAqB3C,IAAI,CAAC2C,YAA1B;AACAtC,MAAAA,MAAM,CAACuC,QAAP,GAAkB5C,IAAI,CAAC4C,QAAvB;AACAvC,MAAAA,MAAM,CAACwC,aAAP,GAAuB,IAAvB;AAEH,KATD;AAYAxC,IAAAA,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,OAAtB,EAA8B,UAAS/B,IAAT,EAAc;AACxCA,MAAAA,IAAI,GAAGe,IAAI,CAACX,mBAAL,CAAyBJ,IAAzB,CAAP;AAEAK,MAAAA,MAAM,CAACyC,YAAP,GAAsB9C,IAAI,CAAC+C,KAA3B;AACA1C,MAAAA,MAAM,CAAC2C,aAAP,GAAuBhD,IAAI,CAACqC,aAA5B;AACH,KALD,GAOAhC,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,uBAAtB,EAA+C,UAAS/B,IAAT,EAAc;AACzD;AACA;AACAA,MAAAA,IAAI,GAAGe,IAAI,CAACH,eAAL,CAAqBZ,IAArB,CAAP;AACA,UAAIiD,IAAI,GAAGC,MAAM,CAACC,OAAP,CAAenD,IAAf,CAAX;AACAiD,MAAAA,IAAI,GAAGlC,IAAI,CAACH,eAAL,CAAqBqC,IAArB,CAAP;AACAvD,MAAAA,EAAE,CAACoB,GAAH,CAAOmC,IAAP,EANyD,CAQzD;AACH,KATD,CAPA;AAkBA5C,IAAAA,MAAM,CAACwB,SAAP,GAAmBE,EAAnB,CAAsB,WAAtB,EAAmC,UAAS/B,IAAT,EAAc;AAC7CA,MAAAA,IAAI,GAAGe,IAAI,CAACX,mBAAL,CAAyBJ,IAAzB,CAAP;AAEAK,MAAAA,MAAM,CAAC+C,QAAP,GAAkB,IAAlB;AACA/C,MAAAA,MAAM,CAACgD,WAAP,GAAqBrD,IAAI,CAACsD,OAA1B;AACH,KALD;AAMH,GAxLI;AA0LLC,EAAAA,mBAAmB,EAAE,+BAAU;AAC3BlD,IAAAA,MAAM,CAACwB,SAAP,GAAmB0B,mBAAnB,CAAuC,SAAvC;AACAlD,IAAAA,MAAM,CAACwB,SAAP,GAAmB0B,mBAAnB,CAAuC,cAAvC;AACAlD,IAAAA,MAAM,CAACwB,SAAP,GAAmB0B,mBAAnB,CAAuC,WAAvC;AACAlD,IAAAA,MAAM,CAACwB,SAAP,GAAmB0B,mBAAnB,CAAuC,iBAAvC;AACAlD,IAAAA,MAAM,CAACwB,SAAP,GAAmB0B,mBAAnB,CAAuC,UAAvC;AACAlD,IAAAA,MAAM,CAACwB,SAAP,GAAmB0B,mBAAnB,CAAuC,uBAAvC;AACAlD,IAAAA,MAAM,CAACwB,SAAP,GAAmB0B,mBAAnB,CAAuC,WAAvC;AACH;AAlMI,CAAT","sourceRoot":"/","sourcesContent":["import * as global from \"GlobalData\";\r\nimport * as constant from \"Constant\";\r\nimport * as ecrypt from \"Encrypt\";\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n    },\r\n\r\n    // use this for initialization\r\n    //mg2020\r\n    onLoad: function () {\r\n        // if(URL.lang != null){\r\n        //     if(URL.lang == \"en\" || URL.lang == \"ch\" || URL.lang == \"tw\" ){\r\n        //         global.setLang(URL.lang);\r\n        //     }else{\r\n        //         global.setLang(\"en\");\r\n        //         URL.lang = \"en\";\r\n        //     }\r\n        // }else{\r\n        //     global.setLang(\"en\");\r\n        //     URL.lang = \"en\";\r\n        // }\r\n    },\r\n\r\n    //#region Encryption\r\n    decode(data){\r\n        // convert from base64 and return object in string\r\n        return atob(data);\r\n    },\r\n\r\n    encode(data){\r\n        // convert string object to base64 string and return the string\r\n        return btoa(data);\r\n    },\r\n\r\n    socketReceiveAction(data){\r\n        if(global.isEncrypt){\r\n            return JSON.parse(this.decode(data));\r\n        }\r\n        else{\r\n            return data;\r\n        }\r\n    },\r\n\r\n    isParsable : function (input) {\r\n        try {\r\n            JSON.parse(input);\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    parseDataFormat: function(data){\r\n        if (this.isParsable(data) == true){\r\n            return JSON.parse(data);\r\n        }else{\r\n            return data;\r\n        }\r\n    },\r\n    //#endregion\r\n\r\n    connectSocket: function(data){\r\n        cc.log(\"--------- Connecting Socket ----------------\");\r\n        var self = this;\r\n        this.firstConnect = true;\r\n        var device_type = \"Desktop\";\r\n        if(cc.sys.isMobile){\r\n            device_type = \"Mobile\";\r\n        }\r\n\r\n        if (cc.sys.isNative) {\r\n            window.io = SocketIO;\r\n            // window.io = SocketIO || io;\r\n            cc.log(\"------------ JSB -------------\");\r\n            // not using bet in ketupat\r\n            if(data == \"bet\"){\r\n                var tempSocket = io.connect(constant.getSocketURL());\r\n                global.setSocket(tempSocket);\r\n                cc.log(constant.getSocketURL());\r\n            }\r\n            else{\r\n                var tempSocket = io.connect(constant.getSocketURL() );\r\n                global.setSocket(tempSocket);\r\n                cc.log(constant.getSocketURL());\r\n            }\r\n        }else {\r\n            cc.log(\"------------ default -------------\");\r\n        // window.io = require('socket.io-client');\r\n            // not using bet in ketupat\r\n            if(data == \"bet\"){\r\n                cc.log(\"constant.getSocketURL() = \"+constant.getSocketURL());\r\n                var tempSocket = io(constant.getSocketURL());\r\n                global.setSocket(tempSocket);\r\n            }\r\n            else{\r\n                cc.log(\"constant.getSocketURL() = \"+constant.getSocketURL());\r\n                var tempSocket = io(constant.getSocketURL());\r\n                global.setSocket(tempSocket);\r\n            }\r\n        }\r\n\r\n        cc.log(\"XXXXXXXXXXXXXXXXXXXXXXx\")\r\n        cc.log('check 1', global.getSocket().connected);\r\n        // if(!cc.sys.isNative){\r\n        global.getSocket().on('connect', function() {\r\n            cc.log(\"Socket Connected\");\r\n            cc.log('check 2', global.getSocket().connected);\r\n            var emit_obj = {\r\n                \r\n            };\r\n\r\n            // emit_obj = ecrypt.encrypt(JSON.stringify(emit_obj));\r\n            global.getSocket().emit(\"subscribe\",emit_obj);\r\n\r\n        });\r\n        self.listenEvent();\r\n        // }\r\n        // this.getComponent(\"MainMenu\").load_layer.active = false;\r\n\r\n        // this.getComponent(\"MainMenu\").initializeVariable();\r\n    },\r\n\r\n    listenEvent: function(){\r\n        var self = this;\r\n        global.getSocket().on('balance', function(data){\r\n            data = self.socketReceiveAction(data);\r\n\r\n            global.settings.balance = data.after_balance;\r\n            global.finishGeneratingBalance = true;\r\n        });\r\n\r\n        global.getSocket().on('reconnecting', function(){\r\n            console.log(\"reconnecting\");\r\n        });\r\n\r\n        global.getSocket().on('reconnect', function(){\r\n            console.log(\"success reconnect\");\r\n        });\r\n\r\n        global.getSocket().on('getResult', function(data){\r\n            data = self.socketReceiveAction(data);\r\n            global.ticket_id = data.ticket_id;\r\n            global.settings.balance = data.balance;\r\n            global.consoScore = data.consoleScore;\r\n            global.perfectScore =data.perfectScore;\r\n            global.platform = data.platform;\r\n            global.finishGetData = true;\r\n    \r\n        });\r\n\r\n        \r\n        global.getSocket().on(\"cheat\",function(data){\r\n            data = self.socketReceiveAction(data);\r\n            \r\n            global.errorMessage = data.error;\r\n            global.playerBalance = data.after_balance;\r\n        }),\r\n\r\n        global.getSocket().on('kick-user-maintenance', function(data){\r\n            // data = self.parseDataFormat(data);\r\n            // var resp = data;\r\n            data = self.parseDataFormat(data);\r\n            var resp = ecrypt.decrypt(data);\r\n            resp = self.parseDataFormat(resp);\r\n            cc.log(resp);\r\n\r\n            // self.getComponent(\"uiController\").showErrorMessage(commonErrorMessage[URL.lang][resp.status_code], true);\r\n        });\r\n\r\n        global.getSocket().on('kick-user', function(data){\r\n            data = self.socketReceiveAction(data);\r\n\r\n            global.isKicked = true;\r\n            global.kickMessage = data.message;\r\n        });\r\n    },\r\n\r\n    removeEventListener: function(){\r\n        global.getSocket().removeEventListener(\"balance\");\r\n        global.getSocket().removeEventListener(\"reconnecting\");\r\n        global.getSocket().removeEventListener(\"reconnect\");\r\n        global.getSocket().removeEventListener(\"onSubscribeDone\");\r\n        global.getSocket().removeEventListener(\"onResult\");\r\n        global.getSocket().removeEventListener(\"kick-user-maintenance\");\r\n        global.getSocket().removeEventListener(\"kick-user\");\r\n    },\r\n\r\n    \r\n});\r\n"]}