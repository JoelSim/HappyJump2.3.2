{"version":3,"sources":["assets\\src\\Network\\Socket.js"],"names":["MobileDetect","require","cc","Class","Component","properties","onLoad","mobileDetect","window","navigator","userAgent","decode","data","ecrypt","decrypt","encode","encrypt","socketReceiveAction","global","isEncrypt","JSON","parse","isParsable","input","e","parseDataFormat","connectSocket","log","self","firstConnect","device_type","sys","isMobile","isNative","io","SocketIO","tempSocket","connect","constant","getSocketURL","setSocket","listenEvent","getSocket","on","isDemo","body","settings","username","access_token","game_code","api_url","host_id","user_id","getDeviceType","getBrowserType","getOSversion","getOSType","h5_app","getPhoneModel","getUserAgent","emit","stringify","balance","after_balance","finishGeneratingBalance","console","ticket_id","consoScore","consoleScore","perfectScore","platform","finishGetData","errorMessage","error","playerBalance","isKicked","kickMessage","removeEventListener","tablet","browserType","browserVersion","osVersion","os","phone"],"mappings":"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","sourceRoot":"/","sourcesContent":["import * as global from \"GlobalData\";\r\nimport * as constant from \"Constant\";\r\nimport * as ecrypt from \"ecrypt\";\r\nvar MobileDetect = require('mobile-detect');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n    },\r\n\r\n    // use this for initialization\r\n    //mg2020\r\n    onLoad: function () {\r\n        this.mobileDetect = new MobileDetect(window.navigator.userAgent);\r\n    },\r\n\r\n    //#region Encryption\r\n    decode(data){\r\n        // convert from base64 and return object in string\r\n        return ecrypt.decrypt(data);\r\n    },\r\n\r\n    encode(data){\r\n        // convert string object to base64 string and return the string\r\n        return ecrypt.encrypt(data);\r\n    },\r\n\r\n    socketReceiveAction(data){\r\n        if(global.isEncrypt){\r\n            return JSON.parse(this.decode(data));\r\n        }\r\n        else{\r\n            return data;\r\n        }\r\n    },\r\n\r\n    isParsable : function (input) {\r\n        try {\r\n            JSON.parse(input);\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    parseDataFormat: function(data){\r\n        if (this.isParsable(data) == true){\r\n            return JSON.parse(data);\r\n        }else{\r\n            return data;\r\n        }\r\n    },\r\n    //#endregion\r\n\r\n    connectSocket: function(data){\r\n        cc.log(\"--------- Connecting Socket ----------------\");\r\n        var self = this;\r\n        this.firstConnect = true;\r\n        var device_type = \"Desktop\";\r\n        if(cc.sys.isMobile){\r\n            device_type = \"Mobile\";\r\n        }\r\n\r\n        if (cc.sys.isNative) {\r\n            window.io = SocketIO;\r\n            // window.io = SocketIO || io;\r\n            cc.log(\"------------ JSB -------------\");\r\n            // not using bet in ketupat\r\n            if(data == \"bet\"){\r\n                var tempSocket = io.connect(constant.getSocketURL());\r\n                global.setSocket(tempSocket);\r\n                cc.log(constant.getSocketURL());\r\n            }\r\n            else{\r\n                var tempSocket = io.connect(constant.getSocketURL() );\r\n                global.setSocket(tempSocket);\r\n                cc.log(constant.getSocketURL());\r\n            }\r\n        }else {\r\n            cc.log(\"------------ default -------------\");\r\n        // window.io = require('socket.io-client');\r\n            // not using bet in ketupat\r\n            if(data == \"bet\"){\r\n                cc.log(\"constant.getSocketURL() = \"+constant.getSocketURL());\r\n                var tempSocket = io(constant.getSocketURL());\r\n                global.setSocket(tempSocket);\r\n            }\r\n            else{\r\n                cc.log(\"constant.getSocketURL() = \"+constant.getSocketURL());\r\n                var tempSocket = io(constant.getSocketURL());\r\n                global.setSocket(tempSocket);\r\n            }\r\n        }\r\n\r\n        self.listenEvent();\r\n    },\r\n\r\n    listenEvent: function(){\r\n        var self = this;\r\n\r\n        global.getSocket().on('connect', function() {\r\n            cc.log(\"Socket Connected\");\r\n\r\n            if(global.isDemo) return;\r\n            var body = {\r\n                \"username\": global.settings.username,\r\n                \"access_token\": global.access_token,\r\n                \"game_code\": global.game_code,\r\n                \"api_url\": global.api_url,\r\n                \"host_id\": global.host_id,\r\n                \"user_id\": global.settings.user_id,\r\n                \"device_type\": self.getDeviceType(),\r\n                \"browser_type\": self.getBrowserType(),\r\n                \"os_version\": self.getOSversion(),\r\n                \"os_type\": self.getOSType(),\r\n                \"h5_app\": global.h5_app,\r\n                \"phone_model\": self.getPhoneModel(),\r\n                \"user_agent\": self.getUserAgent(),\r\n            };\r\n            if (global.isEncrypt) {\r\n                global.getSocket().emit('subscribe', self.encode(JSON.stringify(body)));\r\n            } else {\r\n                global.getSocket().emit('subscribe', body);\r\n            }\r\n        });\r\n\r\n        global.getSocket().on('balance', function(data){\r\n            data = self.socketReceiveAction(data);\r\n\r\n            global.settings.balance = data.after_balance;\r\n            global.finishGeneratingBalance = true;\r\n        });\r\n\r\n        global.getSocket().on('reconnecting', function(){\r\n            console.log(\"reconnecting\");\r\n        });\r\n\r\n        global.getSocket().on('reconnect', function(){\r\n            console.log(\"success reconnect\");\r\n        });\r\n\r\n        global.getSocket().on('getResult', function(data){\r\n            data = self.socketReceiveAction(data);\r\n            global.ticket_id = data.ticket_id;\r\n            global.settings.balance = data.balance;\r\n            global.consoScore = data.consoleScore;\r\n            global.perfectScore =data.perfectScore;\r\n            global.platform = data.platform;\r\n            global.finishGetData = true;\r\n    \r\n        });\r\n\r\n        \r\n        global.getSocket().on(\"cheat\",function(data){\r\n            data = self.socketReceiveAction(data);\r\n            \r\n            global.errorMessage = data.error;\r\n            global.playerBalance = data.after_balance;\r\n        }),\r\n\r\n        global.getSocket().on('kick-user-maintenance', function(data){\r\n        });\r\n\r\n        global.getSocket().on('kickUser', function(data){\r\n            data = self.socketReceiveAction(data);\r\n\r\n            global.isKicked = true;\r\n            global.kickMessage = \"You have exceeded daily profit limit.\";\r\n        });\r\n    },\r\n\r\n    removeEventListener: function(){\r\n        global.getSocket().removeEventListener(\"balance\");\r\n        global.getSocket().removeEventListener(\"reconnecting\");\r\n        global.getSocket().removeEventListener(\"reconnect\");\r\n        global.getSocket().removeEventListener(\"onSubscribeDone\");\r\n        global.getSocket().removeEventListener(\"onResult\");\r\n        global.getSocket().removeEventListener(\"kick-user-maintenance\");\r\n        global.getSocket().removeEventListener(\"kick-user\");\r\n    },\r\n\r\n    //#region Get Device Info Functions\r\n    getDeviceType() {\r\n        if (cc.sys.isMobile) {\r\n            return 1;\r\n        } else if (this.mobileDetect.tablet() != null) {\r\n            return 2;\r\n        } else {\r\n            return 0;\r\n        }\r\n    },\r\n    getBrowserType() {\r\n        return cc.sys.browserType + \" : \" + cc.sys.browserVersion;\r\n    },\r\n    getOSversion() {\r\n        return cc.sys.osVersion;\r\n    },\r\n    getOSType() {\r\n        switch (cc.sys.os) {\r\n            case \"OS X\":\r\n                return 3;\r\n            case \"Android\":\r\n                return 0;\r\n            case \"Windows\":\r\n                return 2;\r\n            case \"Linux\":\r\n                return 4;\r\n            case \"iOS\":\r\n                return 1;\r\n            default:\r\n                return 99;\r\n        }\r\n\r\n    },\r\n    getPhoneModel() {\r\n        if (this.mobileDetect.phone() == null) {\r\n            return \"Desktop\";\r\n        } else {\r\n            return this.mobileDetect.phone();\r\n        }\r\n\r\n    },\r\n    getUserAgent() {\r\n        return window.navigator.userAgent;\r\n    },\r\n    //#endregion\r\n});\r\n"]}