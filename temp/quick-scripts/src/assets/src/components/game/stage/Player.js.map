{"version":3,"sources":["assets\\src\\components\\game\\stage\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { G } from \"../../../G\";\r\n\r\nimport * as global from \"../../../GlobalData\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class Player extends cc.Component {\r\n\r\n    @property(cc.Float)\r\n    public jumpDistance: number = 0;\r\n    @property(cc.Float)\r\n    public platformConsoRate: number = 0;\r\n    @property(cc.Integer)\r\n    public power: number = 0;\r\n    @property(cc.Float)\r\n    public initSpeed: number = 0;\r\n\r\n    public speed: number = 0;\r\n\r\n    public isReadyJump: boolean = false;\r\n\r\n    public direction: number = 1;\r\n\r\n    @property(cc.AudioClip)\r\n    private readyJumpAudio = null;\r\n    private readyJumpAudioId = -1;\r\n    @property(cc.AudioClip)\r\n    private jumpAudio = null;\r\n    private jumpAudioId = -1;\r\n    private isCharging =false;\r\n    private isJumping =false;\r\n    private randomTimer = 2;\r\n    private timer = 0;\r\n    private jumpCount = 0;\r\n    private stage =null;\r\n    private particle = null;\r\n    private particleSystem = null;\r\n    private particleGreen = false;\r\n\r\n    onLoad() {\r\n        cc.find(\"title\",this.node).active = false;\r\n        this.stage = cc.find(\"Canvas/stage\").getComponent(\"Stage\");\r\n        this.particle = cc.find(\"rotateAnchor/particlesystem\",this.node);\r\n        this.particleSystem = this.particle.getComponent(cc.ParticleSystem);\r\n    }\r\n\r\n    public readyJump() {\r\n        this.readyJumpAudioId =  cc.audioEngine.play(this.readyJumpAudio,false,global.getEffectVolume());\r\n        cc.find(\"title\",this.node).active = true;\r\n        this.node.getComponent(cc.Animation).play(\"ChickenCharge\");\r\n        this.particle.active = true;\r\n        this.speed = this.initSpeed;\r\n        this.isReadyJump = true;\r\n        this.isCharging = true;\r\n    }\r\n\r\n    public jumpTo(worldPos:cc.Vec2,cb:Function,cbTarget?:any) {\r\n        this.jumpCount+=1;\r\n        this.isCharging = false;\r\n        this.isJumping = true;\r\n        this.particle.active = false;\r\n\r\n        this.scheduleOnce(()=>{\r\n            this.isJumping=false;\r\n        },1)\r\n        this.node.getComponent(cc.Animation).play(\"ChickenIdle\");\r\n        cc.audioEngine.stop(this.readyJumpAudioId);\r\n        if(global.getEffectVolume()!=0){\r\n            this.jumpAudioId = cc.audioEngine.play(this.jumpAudio,false,1);\r\n        }\r\n        cc.find(\"rotateAnchor/sprite\",this.node).stopAllActions();\r\n        cc.find(\"title\",this.node).active = false;\r\n        let targetPos = this.node.parent.convertToNodeSpaceAR(worldPos)\r\n        this.node.color = cc.Color.WHITE;\r\n        this.isReadyJump = false;\r\n        let resetAction = cc.scaleTo(1,1,1);\r\n        let jumpAction = cc.jumpTo(0.5,targetPos,500,1);\r\n         let rotateAction = cc.rotateBy(0.5,this.direction*(-360));\r\n        let finished = cc.callFunc(()=>{\r\n          \r\n            if(this.jumpCount>=3){\r\n                if(this.direction==1){\r\n                    this.direction=-1;\r\n                }\r\n                else{\r\n                    this.direction=1;\r\n                }\r\n                this.jumpCount=0;\r\n            }\r\n            //this.direction = Math.random()>0.5?1:-1;\r\n            this.speed = 0;\r\n            this.jumpDistance = 0;\r\n            cb();\r\n        },cbTarget);\r\n        cc.find(\"rotateAnchor/sprite\",this.node).runAction(resetAction);\r\n        cc.find(\"rotateAnchor\",this.node).runAction(rotateAction);\r\n        this.node.runAction(cc.sequence(jumpAction,finished))\r\n        \r\n    }\r\n\r\n    RandomInt(min, max){\r\n        return parseInt((Math.random() * ((max + 1 - min) + min)).toString());\r\n    }\r\n\r\n    public update(dt) {\r\n\r\n        this.timer += dt;\r\n\r\n        if(this.timer>=this.randomTimer){\r\n            if(!this.isCharging&&!this.isJumping&&!this.stage.autoJump){\r\n                this.node.getComponent(cc.Animation).play(\"ChickenSingin\");\r\n            }\r\n            this.randomTimer = this.RandomInt(2,8);\r\n            this.timer = 0;\r\n        }\r\n        if(this.isReadyJump) {\r\n            this.speed += dt * this.power;\r\n            this.jumpDistance += this.speed * dt;\r\n            if(this.jumpDistance >= 460 && this.jumpDistance < 520){\r\n                if(this.particleGreen == false){\r\n                    this.particleGreen = true;\r\n                    this.particleSystem.startColor = cc.color(0, 255, 0, 255);\r\n                    this.particleSystem.startColorVar = cc.color(0, 255, 0, 255);\r\n                    this.particleSystem.endColor = cc.color(0, 255, 0, 255);\r\n                    this.particleSystem.endColorVar = cc.color(0, 255, 0, 255);\r\n                }\r\n            }\r\n            else{\r\n                if(this.particleGreen){\r\n                    this.particleGreen = false;\r\n                    this.particleSystem.startColor = cc.color(255, 235, 9, 255);\r\n                    this.particleSystem.startColorVar = cc.color(255, 255, 255, 255);\r\n                    this.particleSystem.endColor = cc.color(143, 22, 22, 255);\r\n                    this.particleSystem.endColorVar = cc.color(255, 255, 255, 255);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n"]}