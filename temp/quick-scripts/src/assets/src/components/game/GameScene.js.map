{"version":3,"sources":["assets\\src\\components\\game\\GameScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { OverPanel } from \"./OverPanel\";\r\nimport { G } from \"../../G\";\r\nimport { Stage } from \"./stage/Stage\";\r\nimport { PlayerDieEvent } from \"../../events/PlayerDieEvent\";\r\nimport { PlayerJumpSuccessEvent } from \"../../events/PlayerJumpSuccessEvent\";\r\nimport { Player } from \"./stage/Player\";\r\nimport * as global from \"../../GlobalData\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport class GameScene extends cc.Component {\r\n\r\n    @property(Stage)\r\n    private stage:Stage = null;\r\n    @property(cc.Label)\r\n    private scoreLabel = null;\r\n    private score = 0;\r\n    @property(OverPanel)\r\n    private overPanel:OverPanel = null;\r\n    @property(cc.AudioClip)\r\n    public bgm:cc.AudioClip = null;\r\n    @property(cc.Node)\r\n    private loadingLayer: cc.Node = null;\r\n    private  mainGame =null;\r\n\r\n    @property(cc.Label)\r\n    message = null;\r\n    @property(cc.Node)\r\n    prompt = null;\r\n\r\n    onLoad(){\r\n        if(cc.sys.isMobile) {\r\n            cc.find(\"Canvas\").getComponent(cc.Canvas).fitHeight = false;\r\n            cc.find(\"Canvas\").getComponent(cc.Canvas).fitWidth = true;\r\n        }\r\n    }\r\n\r\n    start () {\r\n        this.addListeners();\r\n        this.startGame();\r\n        this.mainGame =  cc.find(\"Canvas/stage\").getComponent(\"Stage\");\r\n\r\n    }\r\n\r\n    startGame() {\r\n        this.stage.reset();\r\n        this.stage.enableTouch();\r\n    }\r\n\r\n    onPlayerJumpSuccess(event:PlayerJumpSuccessEvent) {\r\n        let score = event.score;\r\n        this.addSocre(score);\r\n        // this.stage.updateStage(()=>{\r\n        //     this.stage.addBlock();\r\n        // });\r\n    }\r\n\r\n    addSocre(s) {\r\n        this.score+=s;\r\n        this.scoreLabel.string = this.score;\r\n    }\r\n\r\n    onOver() {\r\n        this.stage.disableTouch();\r\n        setTimeout(()=> {\r\n            this.overPanel.show(this.score,this.onRestart,this.onHome,this.mainGame.winAmount,this.mainGame.totalBet,this.mainGame.singleMax,this.mainGame.perfect,this);\r\n        },500);\r\n        cc.log(\"游戏结束\")\r\n    }\r\n\r\n    onHome(){\r\n        this.overPanel.hide();\r\n        this.loadingLayer.active=true;\r\n        cc.director.loadScene(\"StartScene\");\r\n    }\r\n    onRestart() {\r\n        cc.find(\"Canvas/InGameBetting\").getComponent(\"InGameBetting\").isRestarting = true,\r\n        // global.getSocket().disconnect();\r\n        this.overPanel.hide();\r\n        cc.director.loadScene(\"game\");\r\n    }\r\n\r\n    addListeners() {\r\n        G.on(PlayerDieEvent.NAME,this.onOver,this);\r\n        G.on(PlayerJumpSuccessEvent.NAME,this.onPlayerJumpSuccess,this);\r\n    }\r\n\r\n    removeListeners() {\r\n        G.off(PlayerDieEvent.NAME,this.onOver,this);\r\n        G.off(PlayerJumpSuccessEvent.NAME,this.onPlayerJumpSuccess,this);\r\n    }\r\n\r\n    update (dt) {\r\n        if(global.isKicked){\r\n            this.message.string = global.kickMessage;\r\n            this.prompt.active = true;\r\n\t\t}\r\n    }\r\n\r\n    blankScreen(){\r\n        if (global.settings.lobby_url != null && global.settings.lobby_url != \"\") {\r\n            window.open(global.settings.lobby_url, \"_self\");\r\n        } else {\r\n            window.open(\"about:blank\", \"_self\");\r\n        }\r\n    }\r\n}\r\n"]}